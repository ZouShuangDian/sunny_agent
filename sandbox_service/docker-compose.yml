services:
  # 沙箱镜像构建（不运行，仅用于 build）
  sandbox-runtime:
    build:
      context: .
      dockerfile: sandbox.Dockerfile
    image: sunny-sandbox:latest
    profiles:
      - build-only

  sandbox-service:
    build: .
    container_name: sandbox-service
    ports:
      - "8020:8020"
    volumes:
      # 挂载宿主机 Docker socket，让 sandbox-service 能创建兄弟容器
      - /var/run/docker.sock:/var/run/docker.sock
      # 挂载 sunny_agent 目录
      - /Users/zoushuangdian/docker/volumes/sunny_agent:/mnt
    environment:
      # 沙箱容器使用的镜像（已预装 curl/git/jq 等工具）
      SANDBOX_IMAGE: sunny-sandbox:latest
      # 沙箱容器的卷挂载配置
      SANDBOX_VOLUME_HOST: /Users/zoushuangdian/docker/volumes/sunny_agent
      SANDBOX_VOLUME_CONTAINER: /mnt
    restart: unless-stopped
